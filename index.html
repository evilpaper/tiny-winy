<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mini Super Mario</title>
</head>
<body>
    <canvas id="a"></canvas>
    <script>

        const canvas = document.getElementById("a");
        const ctx = canvas.getContext("2d");

        a.width = 15 * 9;
        a.height = 13 * 9;

        const left = 0;
        const up = 0;
        const right = 0;

        const map = [];
        const scroll = 0;
        let vy = 0;
        const end = 0;
        const zoom = 9;
        let x = 2;
        let y = 2;
        const intro = 24;
        let enemy = 24;
        let grounded = 0;

        // Helpers
        // -------
        // This function adds a pipe (id = 4) on the map starting at the given top-left position.
        // The pipe will be 2px wide and as high as needed to touch the ground at y = 11.
        const pipe = (x,y) => {
            for(let Y = 11; Y > y; Y--) {
                map[Y][x] = map[Y][x+1] = 4;
            }
        }


        const stair = (y, x, right) => {
            for (let Y = 11; Y > y; Y--) {
                if (right) {
                    for (X = x; X < x + Y - y; X++) {
                        map[Y][X] = map[10][198] = 1;
                    }
                } else {
                    for (X = x; X > x - Y + y; X--) {
                        map[Y][X] = map[10][198] = 1;
                    }
                }
            } 
        }

        // This function detects and responds to collision between a corner of Mario's pixel and other locks of the map.
        // The 'up' parameter is set if Mario is jumping and means that the collision that is being checked is between Mario's top and a block above him.

        const collision = (x, y, up) => {

            // ~~ is a double NOT bitwise operator. It is used as a faster substitute for Math.floor() for positive numbers.
            if (map[~~y]) {

                // If the map actually has a line at the given Y coordinate.
                // This must be checked because Mario can jump above and fall below the map.
                if (up && map[~~y][~~x] && map[~~y][~~x] != 2) {
                    map[~~y][~~x]--, vy = 0;
                }
            return map[~~y][~~x];
            }
        }

        // MAP
        // ---
        // Define a 211 * 15 grid with 10 lines of sky (i = 0) and 5 lines of ground (id = 1).
        // The ground has 3 holes (id = 0) at coordinates x = 69 & 70, 86 & 87 & 88, 153 & 154.
        for (let i = 14; i >= 0; i--) {
            map[i] = [];
            for (let j = 210; j >= 0; j--) {
                map[i][j] = (i > 10 && ![69, 70, 86, 87, 88, 153, 154].includes(j));
            }
        }

        // Set all the question blocks (id = 3) and brick blocks (id = 1) on the 4th and 8th lines.
        for(i of[22,94,109,129,130]) map[3][i] = 3;
        for(i of[80,81,82,83,84,85,86,87,91,92,93,121,122,123,128,131]) map[3][i] = 1;
        for(i of[8,21,23,78,106,109,112,170]) map[7][i] = 3;
        for(i of[20,22,24,77,79,94,100,118,129,130,88,89,171]) map[7][i] = map[10][198] = 1;
        
    </script>
</body>
</html>